package cl.larrainvial.carterasAFP.commands
{	
	import cl.larrainvial.carterasAFP.business.CarterasAFPDelegate;
	import cl.larrainvial.carterasAFP.events.ProcesoEvent;
	import cl.larrainvial.carterasAFP.model.ModelLocator;
	import cl.larrainvial.carterasAFP.vo.ProcesoVO;
	
	import com.adobe.cairngorm.commands.ICommand;
	import com.adobe.cairngorm.control.CairngormEvent;
	
	import mx.collections.ArrayCollection;
	import mx.controls.Alert;
	import mx.managers.CursorManager;
	import mx.rpc.IResponder;
	
	public class ReporteCarteraCommand implements ICommand, IResponder
	{
		// attributes ============================
	    [Bindable]
		private var model:ModelLocator = ModelLocator.getInstance();
		
		[Bindable]
		private var _Delegate: CarterasAFPDelegate = new CarterasAFPDelegate(this as IResponder);
		
		[Embed(source="assets/images/ok.png")]
		private var okIcon:Class;
		public var evento:ProcesoEvent;
		
		public function execute(event:CairngormEvent) : void
		{	
			evento = ProcesoEvent(event);
			//_Delegate.WMProcesar();
			
			result(null)
		}
		
		
		//----------------------------------------------------------------------------
		public function result(data:Object) : void
		{
			Alert.show(xmlRespuesta + '');
			var xmlRespuesta:XML = XML('<WS xmlns:sql="urn:schemas-microsoft-com:xml-sql"><Resultado><row anio="2018" periodo="2018-03" fondoA="22.26009419" fondoB="17.28000000" fondoC=".00000000" fondoD=".00000000" fondoE=".00000000" total="20.94" nro_cuotas="524286.4296444667000" diferencia_precio=".967538759689922" precio_actual="19.9700" precio_anterior="20.6400" nemo="US8938702045/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="24.77946007" fondoB="22.03200000" fondoC="23.46000000" fondoD="23.46000000" fondoE=".00000000" total="60.32" nro_cuotas="1339253.9964476021314" diferencia_precio=".959931798806479" precio_actual="22.5200" precio_anterior="23.4600" nemo="US9842451000/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="6.83243531" fondoB="6.58549080" fondoC="6.73000000" fondoD="6.73000000" fondoE="6.73000000" total="243.54" nro_cuotas="17596820.8092485549132" diferencia_precio="1.028231797919762" precio_actual="6.9200" precio_anterior="6.7300" nemo="US1512908898/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="-19.23589744" fondoB="54.36231884" fondoC="68.20000000" fondoD="68.20000000" fondoE="68.20000000" total="10.50" nro_cuotas="76575.2625437572928" diferencia_precio="1.005278592375366" precio_actual="68.5600" precio_anterior="68.2000" nemo="US1912411089/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="64.24874239" fondoB="60.86016414" fondoC="62.66000000" fondoD="62.66000000" fondoE="62.66000000" total="142.14" nro_cuotas="1161274.5098039215686" diferencia_precio=".976699648898819" precio_actual="61.2000" precio_anterior="62.6600" nemo="US3999091008/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA=".00000000" fondoB=".00000000" fondoC=".00000000" fondoD=".00000000" fondoE=".00000000" total=".00" nro_cuotas=".0000000000000" diferencia_precio=".991620111731843" precio_actual="7.1000" precio_anterior="7.1600" nemo="US40053C1053/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="35.82736842" fondoB="25.78044053" fondoC=".00000000" fondoD=".00000000" fondoE=".00000000" total="14.40" nro_cuotas="245148.1103166496424" diferencia_precio=".963582677165354" precio_actual="29.3700" precio_anterior="30.4800" nemo="US40054A1088/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="-8.91473684" fondoB="3.83370370" fondoC="28.23000000" fondoD="28.23000000" fondoE="28.23000000" total=".64" nro_cuotas="11228.0701754385964" diferencia_precio="1.009564293304994" precio_actual="28.5000" precio_anterior="28.2300" nemo="PAP169941328/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="9.54882662" fondoB="7.96918206" fondoC="8.78000000" fondoD="8.78000000" fondoE="8.78000000" total="44.02" nro_cuotas="2336518.0467091295116" diferencia_precio="1.072892938496583" precio_actual="9.4200" precio_anterior="8.7800" nemo="US10552T1079/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="10.15380783" fondoB="6.94853186" fondoC="8.62000000" fondoD="8.62000000" fondoE="8.62000000" total="25.72" nro_cuotas="1525504.1518386714116" diferencia_precio=".977958236658932" precio_actual="8.4300" precio_anterior="8.6200" nemo="US21240E1055/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="142.44260051" fondoB="130.30921053" fondoC="136.60000000" fondoD="136.60000000" fondoE="136.60000000" total="103.90" nro_cuotas="386791.7504281140644" diferencia_precio=".983235724743777" precio_actual="134.3100" precio_anterior="136.6000" nemo="PAP310761054/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="20.26903846" fondoB="18.19505183" fondoC="19.12000000" fondoD="19.12000000" fondoE=".00000000" total="76.12" nro_cuotas="2008443.2717678100263" diferencia_precio=".991108786610878" precio_actual="18.9500" precio_anterior="19.1200" nemo="US31573A1097/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="97.14861111" fondoB="88.65135659" fondoC="92.85000000" fondoD="92.85000000" fondoE="92.85000000" total="99.44" nro_cuotas="539965.2476107732406" diferencia_precio=".991707054388799" precio_actual="92.0800" precio_anterior="92.8500" nemo="US3444191064/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="6.05768061" fondoB="4.34460251" fondoC="5.09000000" fondoD="5.09000000" fondoE=".00000000" total="15.40" nro_cuotas="1492248.0620155038759" diferencia_precio="1.013752455795677" precio_actual="5.1600" precio_anterior="5.0900" nemo="US3737371050/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="9.27000000" fondoB="8.52150000" fondoC="8.97000000" fondoD="8.97000000" fondoE="8.97000000" total="106.32" nro_cuotas="5959641.2556053811659" diferencia_precio=".994425863991081" precio_actual="8.9200" precio_anterior="8.9700" nemo="LU0584671464/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="16.41406716" fondoB="15.64891675" fondoC="16.04000000" fondoD="16.04000000" fondoE="16.04000000" total="268.46" nro_cuotas="8538804.0712468193384" diferencia_precio=".980049875311720" precio_actual="15.7200" precio_anterior="16.0400" nemo="US4655621062/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="7.01756132" fondoB="6.54054490" fondoC="6.78000000" fondoD="6.78000000" fondoE="6.78000000" total="169.84" nro_cuotas="12343023.2558139534883" diferencia_precio="1.014749262536873" precio_actual="6.8800" precio_anterior="6.7800" nemo="US02319V1035/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="15.64825911" fondoB="12.65090909" fondoC=".00000000" fondoD=".00000000" fondoE=".00000000" total="22.24" nro_cuotas="783098.5915492957746" diferencia_precio=".999296270232230" precio_actual="14.2000" precio_anterior="14.2100" nemo="US71654V4086/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="186.32205128" fondoB="76.57348837" fondoC=".00000000" fondoD="113.53999999" fondoE=".00000000" total="5.48" nro_cuotas="25321.1348304223269" diferencia_precio=".953056191650519" precio_actual="108.2100" precio_anterior="113.5400" nemo="US05961W1053/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="-8.91473684" fondoB="3.83370370" fondoC="28.23000000" fondoD="28.23000000" fondoE="28.23000000" total=".64" nro_cuotas="11228.0701754385964" diferencia_precio="1.009564293304994" precio_actual="28.5000" precio_anterior="28.2300" nemo="PAP169941328/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="9.54882662" fondoB="7.96918206" fondoC="8.78000000" fondoD="8.78000000" fondoE="8.78000000" total="44.02" nro_cuotas="2336518.0467091295116" diferencia_precio="1.072892938496583" precio_actual="9.4200" precio_anterior="8.7800" nemo="US10552T1079/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="10.15380783" fondoB="6.94853186" fondoC="8.62000000" fondoD="8.62000000" fondoE="8.62000000" total="25.72" nro_cuotas="1525504.1518386714116" diferencia_precio=".977958236658932" precio_actual="8.4300" precio_anterior="8.6200" nemo="US21240E1055/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="142.44260051" fondoB="130.30921053" fondoC="136.60000000" fondoD="136.60000000" fondoE="136.60000000" total="103.90" nro_cuotas="386791.7504281140644" diferencia_precio=".983235724743777" precio_actual="134.3100" precio_anterior="136.6000" nemo="PAP310761054/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="20.26903846" fondoB="18.19505183" fondoC="19.12000000" fondoD="19.12000000" fondoE=".00000000" total="76.12" nro_cuotas="2008443.2717678100263" diferencia_precio=".991108786610878" precio_actual="18.9500" precio_anterior="19.1200" nemo="US31573A1097/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="97.14861111" fondoB="88.65135659" fondoC="92.85000000" fondoD="92.85000000" fondoE="92.85000000" total="99.44" nro_cuotas="539965.2476107732406" diferencia_precio=".991707054388799" precio_actual="92.0800" precio_anterior="92.8500" nemo="US3444191064/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="6.05768061" fondoB="4.34460251" fondoC="5.09000000" fondoD="5.09000000" fondoE=".00000000" total="15.40" nro_cuotas="1492248.0620155038759" diferencia_precio="1.013752455795677" precio_actual="5.1600" precio_anterior="5.0900" nemo="US3737371050/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="9.27000000" fondoB="8.52150000" fondoC="8.97000000" fondoD="8.97000000" fondoE="8.97000000" total="106.32" nro_cuotas="5959641.2556053811659" diferencia_precio=".994425863991081" precio_actual="8.9200" precio_anterior="8.9700" nemo="LU0584671464/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="64.74105089" fondoB="60.14734330" fondoC="62.67000000" fondoD="62.67000000" fondoE="62.67000000" total="160.24" nro_cuotas="1321240.1055408970976" diferencia_precio=".967608105951811" precio_actual="60.6400" precio_anterior="62.6700" nemo="US6976602077/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="17.77943262" fondoB="14.13052464" fondoC="15.90000000" fondoD=".00000000" fondoE=".00000000" total="34.02" nro_cuotas="1069138.9063482086737" diferencia_precio="1.000628930817610" precio_actual="15.9100" precio_anterior="15.9000" nemo="US87936R1068/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="22.26009419" fondoB="17.28000000" fondoC=".00000000" fondoD=".00000000" fondoE=".00000000" total="20.94" nro_cuotas="524286.4296444667000" diferencia_precio=".967538759689922" precio_actual="19.9700" precio_anterior="20.6400" nemo="US8938702045/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="16.41406716" fondoB="15.64891675" fondoC="16.04000000" fondoD="16.04000000" fondoE="16.04000000" total="268.46" nro_cuotas="8538804.0712468193384" diferencia_precio=".980049875311720" precio_actual="15.7200" precio_anterior="16.0400" nemo="US4655621062/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="24.77946007" fondoB="22.03200000" fondoC="23.46000000" fondoD="23.46000000" fondoE=".00000000" total="60.32" nro_cuotas="1339253.9964476021314" diferencia_precio=".959931798806479" precio_actual="22.5200" precio_anterior="23.4600" nemo="US9842451000/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="15.64825911" fondoB="12.65090909" fondoC=".00000000" fondoD=".00000000" fondoE=".00000000" total="22.24" nro_cuotas="783098.5915492957746" diferencia_precio=".999296270232230" precio_actual="14.2000" precio_anterior="14.2100" nemo="US71654V4086/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="7.01756132" fondoB="6.54054490" fondoC="6.78000000" fondoD="6.78000000" fondoE="6.78000000" total="169.84" nro_cuotas="12343023.2558139534883" diferencia_precio="1.014749262536873" precio_actual="6.8800" precio_anterior="6.7800" nemo="US02319V1035/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="186.32205128" fondoB="76.57348837" fondoC=".00000000" fondoD="113.53999999" fondoE=".00000000" total="5.48" nro_cuotas="25321.1348304223269" diferencia_precio=".953056191650519" precio_actual="108.2100" precio_anterior="113.5400" nemo="US05961W1053/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="6.83243531" fondoB="6.58549080" fondoC="6.73000000" fondoD="6.73000000" fondoE="6.73000000" total="243.54" nro_cuotas="17596820.8092485549132" diferencia_precio="1.028231797919762" precio_actual="6.9200" precio_anterior="6.7300" nemo="US1512908898/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="-19.23589744" fondoB="54.36231884" fondoC="68.20000000" fondoD="68.20000000" fondoE="68.20000000" total="10.50" nro_cuotas="76575.2625437572928" diferencia_precio="1.005278592375366" precio_actual="68.5600" precio_anterior="68.2000" nemo="US1912411089/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="64.24874239" fondoB="60.86016414" fondoC="62.66000000" fondoD="62.66000000" fondoE="62.66000000" total="142.14" nro_cuotas="1161274.5098039215686" diferencia_precio=".976699648898819" precio_actual="61.2000" precio_anterior="62.6600" nemo="US3999091008/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA=".00000000" fondoB=".00000000" fondoC=".00000000" fondoD=".00000000" fondoE=".00000000" total=".00" nro_cuotas=".0000000000000" diferencia_precio=".991620111731843" precio_actual="7.1000" precio_anterior="7.1600" nemo="US40053C1053/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="35.82736842" fondoB="25.78044053" fondoC=".00000000" fondoD=".00000000" fondoE=".00000000" total="14.40" nro_cuotas="245148.1103166496424" diferencia_precio=".963582677165354" precio_actual="29.3700" precio_anterior="30.4800" nemo="US40054A1088/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="64.74105089" fondoB="60.14734330" fondoC="62.67000000" fondoD="62.67000000" fondoE="62.67000000" total="160.24" nro_cuotas="1321240.1055408970976" diferencia_precio=".967608105951811" precio_actual="60.6400" precio_anterior="62.6700" nemo="US6976602077/SIN TICKER" /><row anio="2018" periodo="2018-03" fondoA="17.77943262" fondoB="14.13052464" fondoC="15.90000000" fondoD=".00000000" fondoE=".00000000" total="34.02" nro_cuotas="1069138.9063482086737" diferencia_precio="1.000628930817610" precio_actual="15.9100" precio_anterior="15.9000" nemo="US87936R1068/SIN TICKER" /></Resultado><Error Status="0" /></WS>');//XML(data.result);
			
			model.arrProceso = new ArrayCollection();
			for each(var item:* in xmlRespuesta.Resultado.row)
			{				
				var proceso:ProcesoVO = new ProcesoVO();
				proceso.fillAttributes = item;
				model.arrProceso.addItem(proceso);
			}
			evento.callback.call(this, model.arrProceso); 
			
		}
				
		//----------------------------------------------------------------------------
		public function fault(info: Object):void
		{
			CursorManager.removeBusyCursor();
			Alert.show("Error con el Servicio, favor comunicarse con el administrador", "ERROR", Alert.OK, null, null);
		}
	}
}




